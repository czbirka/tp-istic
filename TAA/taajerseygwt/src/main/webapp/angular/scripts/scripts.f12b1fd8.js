"use strict";var angularApp=angular.module("tpangularApp",["ngAnimate","ngSanitize","ui.router","mgcrea.ngStrap","ui.select"]);angularApp.config(["$stateProvider","$urlRouterProvider","$alertProvider","uiSelectConfig",function(a,b,c,d){d.theme="bootstrap",angular.extend(c.defaults,{duration:3,container:"body",placement:"top-left"}),b.otherwise("/home"),a.state("home",{url:"/home",templateUrl:"views/rideList.tpl.html",controller:"HomeCtrl"}).state("rides",{"abstract":!0,url:"/rides",template:"<ui-view/>"}).state("rides.create",{url:"/create",templateUrl:"views/rideForm.tpl.html",controller:"CreateCtrl"}).state("rides.view",{url:"/view/:id",templateUrl:"views/rideView.tpl.html",controller:"ViewCtrl"}).state("rides.update",{url:"/update/:id",templateUrl:"views/rideForm.tpl.html",controller:"UpdateCtrl"}).state("rides.delete",{url:"/delete/:id",controller:"DeleteCtrl"}).state("users",{"abstract":!0,url:"/users",template:"<ui-view/>"}).state("users.list",{url:"/",templateUrl:"views/userList.tpl.html",controller:"UsersCtrl"}).state("users.register",{url:"/register",templateUrl:"views/userForm.tpl.html",controller:"RegisterCtrl"}).state("users.user",{url:"/:id",templateUrl:"views/userInfo.tpl.html",controller:"UserInfoCtrl"}).state("users.update",{url:"/update/:id",templateUrl:"views/userForm.tpl.html",controller:"UpdateUserCtrl"}).state("users.delete",{url:"/delete/:id",controller:"DeleteUserCtrl"})}]);var controllers=angular.module("tpangularApp");controllers.controller("HomeCtrl",["$scope","RideService",function(a,b){b.getAll().then(function(b){a.rides=b})}]),controllers.controller("CreateCtrl",["$scope","$state","RideService","UserService","$alert",function(a,b,c,d,e){a.$state=b,a.pageName="Create a Ride",a.ride={origin:"",destination:"",leavingDate:new Date,seatNumber:"",driver:null},a.users=[],d.getAll().then(function(b){a.users=b}),a.submit=function(){a.ride.driver=angular.fromJson(a.ride.driver),c.create(a.ride).then(function(){e({title:"Success:",content:"The ride was created!",type:"success",show:!0}),b.go("home")},function(){e({title:"Error",content:"Failed to create the ride.",type:"danger",show:!0})})},a.cancel=function(){b.go("home")}}]),controllers.controller("ViewCtrl",["$state","$stateParams","$scope","RideService","UserService","$q","$modal","$alert",function(a,b,c,d,e,f,g,h){var i=[];i.push(d.get(b.id)),i.push(e.getAll()),f.all(i).then(function(a){c.ride=a[0],c.users=[];var b=c.ride.driver,d=a[1].filter(function(a){return a.id!==b.id});angular.forEach(d,function(a){-1===a.ridesAsPassengerID.indexOf(c.ride.id)&&c.users.push(a)})});var j=g({scope:c,template:"views/modal/join_modal.tpl.html",show:!1});c.askUsername=function(){j.$promise.then(j.show)},c.userSelected=function(a){return void 0!==a},c.join=function(a){var b=c.ride;a=angular.fromJson(a),d.addPassengerToRide(a,b).then(function(){h({title:"Success:",content:"You have joined the ride!",type:"success",show:!0}),c.redirect()},function(){h({title:"Error:",content:"Failed to join the ride.",type:"danger",show:!0}),c.redirect()})},c.redirect=function(){j.hide(),a.go(a.current,b,{reload:!0})}}]),controllers.controller("UpdateCtrl",["$state","$stateParams","$scope","RideService","UserService","$alert","$q",function(a,b,c,d,e,f,g){var h=b.id,i=[];c.pageName="Update",c.showDriver=!1,i.push(d.get(h)),i.push(e.getAll()),g.all(i).then(function(a){c.ride=a[0],c.users=a[1]}),c.submit=function(){d.update(c.ride).then(function(){f({title:"Success:",content:"The ride has been updated.",type:"success",show:!0}),a.go("home",b,{reload:!0})})},c.cancel=function(){a.go("home")}}]),controllers.controller("DeleteCtrl",["$state","$stateParams","$scope","$http","$alert",function(a,b,c,d,e){d.delete("/rest/rides/delete/"+b.id).success(function(){e({title:"Success:",content:"The ride was deleted.",type:"success",show:!0}),a.go("home")}).error(function(b,c){e({title:"Error:",content:c,type:"danger",show:!0}),a.go("home")})}]),controllers.controller("UsersCtrl",["$scope","UserService",function(a,b){b.getAll().then(function(b){a.users=b})}]),controllers.controller("UserInfoCtrl",["$scope","$stateParams","UserService","RideService","$q",function(a,b,c,d,e){c.get(b.id).then(function(b){var c=b,f=[];f.push(d.getByIds(c.ridesAsDriverID)),f.push(d.getByIds(c.ridesAsPassengerID)),e.all(f).then(function(b){a.user=c,a.ridesAsDriver=b[0],a.ridesAsPassenger=b[1]})})}]),controllers.controller("RegisterCtrl",["$state","$scope","UserService","$alert",function(a,b,c,d){b.pageName="Create a user",b.user={username:"",password:""},b.submit=function(){c.create(b.user).then(function(){d({title:"Success:",content:"The user has been created successfully.",type:"success",show:!0}),a.go("users.list")})},b.cancel=function(){a.go("home")}}]),controllers.controller("UpdateUserCtrl",["$scope","$state","$stateParams","UserService","$alert",function(a,b,c,d,e){d.get(c.id).then(function(b){a.user=b}),a.submit=function(){d.update(a.user).then(function(){e({title:"Success:",content:"The user has been updated.",type:"success",show:!0}),b.go("users.list")},function(a){console.log(a)})},a.cancel=function(){b.go("home")}}]),controllers.controller("DeleteUserCtrl",["$state","$stateParams","$scope","$http","$alert",function(a,b,c,d,e){d.delete("/rest/users/delete/"+b.id).success(function(){e({title:"Success:",content:"The user was deleted.",type:"success",show:!0}),a.go("users.list")})}]);var services=angular.module("tpangularApp");services.factory("RideService",["$http","$q",function(a,b){var c={};return c.getAll=function(){var c=b.defer();return a.get("/rest/rides").success(function(a){c.resolve(a)}).error(function(){c.reject()}),c.promise},c.get=function(c){var d=b.defer();return a.get("/rest/rides/"+c).success(function(a){d.resolve(a)}).error(function(){d.reject()}),d.promise},c.getByIds=function(a){var d=b.defer(),e=[];return angular.forEach(a,function(a){e.push(c.get(a))}),b.all(e).then(function(a){d.resolve(a)},function(){d.reject()}),d.promise},c.create=function(c){var d=b.defer();return a.post("/rest/rides/create",c).success(function(){d.resolve()}).error(function(){d.reject()}),d.promise},c.update=function(c){console.log(c);var d=b.defer();return a.put("/rest/rides/update",c).success(function(a){d.resolve(a)}).error(function(){d.reject()}),d.promise},c.addPassengerToRide=function(c,d){var e=b.defer();return a.put("/rest/rides/"+d.id+"/join",c).success(function(){e.resolve()}).error(function(){e.reject()}),e.promise},c}]),services.factory("UserService",["$http","$q",function(a,b){var c={};return c.getAll=function(){var c=b.defer();return a.get("/rest/users").success(function(a){c.resolve(a)}).error(function(){c.reject()}),c.promise},c.get=function(c){var d=b.defer();return a.get("/rest/users/"+c).success(function(a){d.resolve(a)}).error(function(){d.reject()}),d.promise},c.create=function(c){var d=b.defer();return a.post("/rest/users/create/",c).success(function(){d.resolve()}).error(function(){d.reject()}),d.promise},c.update=function(c){var d=b.defer();return a.put("/rest/users/update/"+c.id,c).success(function(){d.resolve()}).error(function(){d.reject()}),d.promise},c}]);